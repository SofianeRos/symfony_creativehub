{% extends 'admin/base.html.twig' %}

{% block title %}Défis - Administration
{% endblock %}

{% block admin_content %}
	<div class="mb-8">
		<h1 class="text-4xl text-gray-900 mb-2">Gestion des défis</h1>
		<p class="text-gray-600">Gérez les défis de la plateforme</p>
	</div>

	<!-- Recherche et filtres -->
	<div class="card-padded mb-6">
		<form method="get" class="flex flex-col md:flex-row gap-4">
			<input type="text" name="search" value="{{ search }}" placeholder="Rechercher par titre ou description..." class="form-input ">
			<select name="filter" class="form-select">
				<option value="all" {{ filter == 'all' ? 'selected' : '' }}>Tous</option>
				<option value="active" {{ filter == 'active' ? 'selected' : '' }}>Actifs</option>
				<option value="inactive" {{ filter == 'inactive' ? 'selected' : '' }}>Inactifs</option>
			</select>
			<button type="submit" class="btn-primary">Rechercher</button>
			<a href="{{ path('app_admin_challenge') }}" class="btn-secondary">Réinitialiser</a>
		</form>
	</div>

	<!-- Liste des défis -->
	<div class="card-padded">
		{% if challenges|length > 0 %}
			<div class="space-y-4">
				{% for challenge in challenges %}
					<div class="border border-gray-200 rounded-lg p-6 hover:bg-gray-50 {{ not challenge.isActive ? 'opacity-60' : '' }}">
						<div class="flex items-start justify-between">
							<div class="flex-1">
								<div class="flex items-center gap-3 mb-2">
									<h3 class="text-xl text-gray-900">
										<a href="{{ path('app_admin_challenge_show', {id: challenge.id}) }}" class="hover:underline">
											{{ challenge.title }}
										</a>
									</h3>
									{% if not challenge.isActive %}
										<span class="badge-category-sm " style="background-color: var(--color-error-light); color: var(--color-error);">
											Inactif
										</span>
									{% endif %}
								</div>
								<p class="text-gray-600 mb-3">{{ challenge.description|slice(0, 200) }}
									{% if challenge.description|length > 200 %}...
									{% endif %}
								</p>
								<div class="flex items-center gap-4 text-sm text-gray-500">
									<span class="badge-category-sm">{{ challenge.category.label }}</span>
									<span>Par
										{{ challenge.user.pseudo }}</span>
									<span>{{ challenge.createdAt|date('d/m/Y') }}</span>
									<span>{{ challenge.getVotes().count() }}
										vote{{ challenge.getVotes().count() > 1 ? 's' : '' }}</span>
									<span>{{ challenge.getComments().count() }}
										commentaire{{ challenge.getComments().count() > 1 ? 's' : '' }}</span>
								</div>
							</div>
							<div class="ml-4">
								<a href="{{ path('app_admin_challenge_show', {id: challenge.id}) }}" class="btn-secondary text-sm">Voir</a>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		{% else %}
			<p class="text-center text-gray-600 py-8">Aucun défi trouvé</p>
		{% endif %}
	</div>
{% endblock %}
