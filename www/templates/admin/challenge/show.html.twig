{% extends 'admin/base.html.twig' %}

{% block title %}Défi : {{ challenge.title }} - Administration{% endblock %}

{% block admin_content %}
<div class="mb-8">
    <a href="{{ path('app_admin_challenge') }}" class="link-nav mb-4 inline-block">
        ← Retour à la liste
    </a>
    <h1 class="text-4xl text-gray-900 mb-2">{{ challenge.title }}</h1>
    <p class="text-gray-600">Par {{ challenge.user.pseudo }} • {{ challenge.createdAt|date('d/m/Y à H:i') }}</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Informations -->
    <div class="lg:col-span-2 space-y-6">
        <div class="card-padded">
            <h2 class="text-2xl text-gray-900 mb-4">Informations</h2>
            <dl class="space-y-4">
                <div>
                    <dt class="text-sm font-medium text-gray-500">Titre</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{ challenge.title }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Description</dt>
                    <dd class="mt-1 text-sm text-gray-900 whitespace-pre-line">{{ challenge.description }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Catégorie</dt>
                    <dd class="mt-1">
                        <span class="badge-category-sm">{{ challenge.category.label }}</span>
                    </dd>
                </div>
                {% if challenge.deadline %}
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Date limite</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ challenge.deadline|date('d/m/Y à H:i') }}</dd>
                    </div>
                {% endif %}
                <div>
                    <dt class="text-sm font-medium text-gray-500">Statut</dt>
                    <dd class="mt-1">
                        {% if challenge.isActive %}
                            <span class="badge-category-sm" style="background-color: var(--color-success-light); color: var(--color-success);">Actif</span>
                        {% else %}
                            <span class="badge-category-sm" style="background-color: var(--color-error-light); color: var(--color-error);">Inactif</span>
                        {% endif %}
                    </dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Statistiques</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        {{ challenge.getVotes().count() }} vote{{ challenge.getVotes().count() > 1 ? 's' : '' }} • 
                        {{ challenge.getComments().count() }} commentaire{{ challenge.getComments().count() > 1 ? 's' : '' }}
                    </dd>
                </div>
            </dl>
        </div>

        <!-- Médias -->
        {% if challenge.medias|length > 0 %}
            <div class="card-padded">
                <h2 class="text-2xl text-gray-900 mb-4">Fichiers</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    {% for media in challenge.medias %}
                        {% if media.path matches '/\\.(jpg|jpeg|png|gif|webp|svg)$/i' %}
                            <img src="{{ media.path }}" alt="Média {{ loop.index }}" class="w-full h-32 object-cover rounded-lg border border-gray-200">
                        {% else %}
                            <div class="w-full h-32 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center">
                                <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Actions -->
    <div class="space-y-6">
        <div class="card-padded">
            <h2 class="text-2xl text-gray-900 mb-4">Actions</h2>
            <div class="space-y-3">
                <a href="{{ path('app_challenge_show', {id: challenge.id}) }}" class="btn-secondary w-full" target="_blank">
                    Voir sur le site
                </a>
                <form method="post" action="{{ path('app_admin_challenge_toggle_active', {id: challenge.id}) }}">
                    <input type="hidden" name="_token" value="{{ csrf_token('toggle_challenge_' ~ challenge.id) }}">
                    <button type="submit" class="btn-secondary w-full">
                        {{ challenge.isActive ? 'Désactiver' : 'Activer' }} le défi
                    </button>
                </form>
                <form method="post" action="{{ path('app_admin_challenge_delete', {id: challenge.id}) }}" 
                      onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce défi ?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete_challenge_' ~ challenge.id) }}">
                    <button type="submit" class="btn-danger w-full">Supprimer le défi</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
 